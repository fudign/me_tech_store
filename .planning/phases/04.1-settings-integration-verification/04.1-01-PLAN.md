---
phase: 04.1-settings-integration-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - resources/views/layouts/app.blade.php
  - .planning/phases/04-polish-launch/04-VERIFICATION.md
  - .planning/ROADMAP.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Storefront top bar displays dynamic phone number from Setting::get('site.phone')"
    - "Storefront top bar displays dynamic address from Setting::get('site.address')"
    - "Footer displays dynamic email from Setting::get('site.email')"
    - "Footer displays dynamic text from Setting::get('site.footer_text')"
    - "Admin changes to settings appear immediately on storefront after cache clear"
    - "Phase 4 verification document exists and confirms all deliverables"
  artifacts:
    - path: "resources/views/layouts/app.blade.php"
      provides: "Storefront layout with dynamic settings integration"
      contains: "Setting::get"
    - path: ".planning/phases/04-polish-launch/04-VERIFICATION.md"
      provides: "Phase 4 verification document"
      min_lines: 100
  key_links:
    - from: "resources/views/layouts/app.blade.php"
      to: "App\\Models\\Setting::get()"
      via: "Blade directive calls static method"
      pattern: "Setting::get\\(['\"]site\\."
---

<objective>
Close integration gap: Wire Settings system into storefront layout and create Phase 4 verification artifact to document completion

**Purpose:** Settings were implemented and cached in Phase 4 (04-03) but never integrated into the frontend. The storefront layout (app.blade.php) still has hardcoded values for phone, address, email, and footer text. This plan completes the Settings ‚Üí Storefront integration and creates the missing verification document.

**Output:**
- Fully functional Settings integration: Admin changes in Settings panel appear on storefront
- Phase 4 verification document confirming all SEO, image optimization, performance, and settings deliverables
- Updated ROADMAP.md reflecting Phase 4.1 completion
</objective>

<execution_context>
@C:\Users\user\Desktop\mi_tech\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\user\Desktop\mi_tech\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\user\Desktop\mi_tech\.planning\PROJECT.md
@C:\Users\user\Desktop\mi_tech\.planning\ROADMAP.md
@C:\Users\user\Desktop\mi_tech\.planning\STATE.md

# Phase 4 completion context
@C:\Users\user\Desktop\mi_tech\.planning\phases\04-polish-launch\04-03-SUMMARY.md
@C:\Users\user\Desktop\mi_tech\.planning\phases\04-polish-launch\04-01-SUMMARY.md

# Settings model (already cached)
@C:\Users\user\Desktop\mi_tech\app\Models\Setting.php

# Current storefront layout (hardcoded values)
@C:\Users\user\Desktop\mi_tech\resources\views\layouts\app.blade.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate Settings into storefront layout</name>
  <files>resources/views/layouts/app.blade.php</files>
  <action>
Replace hardcoded values in app.blade.php with Setting::get() calls:

**Top bar section (lines 54-59):**
- Replace `+996 (555) 00-00-00` with `{{ Setting::get('site.phone', '+996 (555) 00-00-00') }}`
- Replace `–ë–∏—à–∫–µ–∫, –ø—Ä. –ú–∞–Ω–∞—Å–∞ 101` with `{{ Setting::get('site.address', '–ë–∏—à–∫–µ–∫, –ø—Ä. –ú–∞–Ω–∞—Å–∞ 101') }}`

**Footer contacts section (lines 180-193):**
- Replace hardcoded address with `{{ Setting::get('site.address', '–ë–∏—à–∫–µ–∫, –ø—Ä. –ú–∞–Ω–∞—Å–∞ 101') }}`
- Replace hardcoded phone with `{{ Setting::get('site.phone', '+996 (555) 00-00-00') }}`
- Replace hardcoded email `sales@gadget.kg` with `{{ Setting::get('site.email', 'sales@gadget.kg') }}`

**Footer description (lines 153-155):**
- Replace hardcoded text "–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ Xiaomi..." with `{{ Setting::get('site.footer_text', '–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ Xiaomi. –ú—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –ª—É—á—à–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∏ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º.') }}`

**Why these changes:**
- Settings model already implements 24-hour caching (from 04-03 summary)
- Fallback values maintain site functionality even if settings not configured
- Admin Settings panel (created in Phase 3, 03-02) can now control storefront display
- Cache::forget in Setting::set() ensures updates appear after refresh

**What NOT to change:**
- Keep all HTML structure, Tailwind classes, and icons unchanged
- Don't modify cart count Alpine.js logic (lines 94-108)
- Don't change navigation menu or mobile search
- Keep social media links, copyright, and payment icons as-is
  </action>
  <verify>
1. Search layout file for Setting::get calls: `grep -n "Setting::get" resources/views/layouts/app.blade.php`
2. Verify 4 Setting::get calls present (phone appears twice, address twice, email once, footer_text once)
3. Check each call has fallback value as second parameter
  </verify>
  <done>
- app.blade.php contains 6 Setting::get() calls with appropriate fallbacks
- No hardcoded phone/address/email/footer_text strings remain in top bar or footer
- Layout maintains all existing functionality and styling
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Phase 4 verification document</name>
  <files>.planning/phases/04-polish-launch/04-VERIFICATION.md</files>
  <action>
Create comprehensive verification document for Phase 4 (Polish & Launch) covering all three plans:

**Structure:**
```markdown
---
phase: 04-polish-launch
verified: [DATE]
status: complete
plans_verified: [04-01, 04-02, 04-03]
requirements_met: [SEO-01 through SEO-07, PERF-01 through PERF-04, ERR-02, SEC-06]
---

# Phase 4 Verification: Polish & Launch

## Overview
[Summary of phase goals and completion]

## Plan Verification

### 04-01: SEO Optimization
**Status:** ‚úÖ Complete

**Deliverables verified:**
- [ ] Meta tags (title, description) auto-generate and allow admin override
- [ ] Product pages have unique SEO-friendly URLs (/products/{slug})
- [ ] Category pages have unique SEO-friendly URLs (/categories/{slug})
- [ ] sitemap.xml generated and accessible at /sitemap.xml
- [ ] robots.txt dynamic based on environment
- [ ] OpenGraph tags for social sharing
- [ ] JSON-LD Product schema for rich snippets
- [ ] Admin SEO editor in product/category forms

**Evidence:**
- SeoService.php implements auto-generation with manual override
- sitemap:generate command scheduled daily
- robots.txt blocks /admin, /api, /cart on production
- SERP preview in admin forms

### 04-02: Image Optimization
**Status:** ‚ö†Ô∏è Complete (needs browser testing)

**Deliverables verified:**
- [ ] WebP conversion with JPEG fallback (<picture> element)
- [ ] Thumbnail sizes: 200px, 600px, 1200px
- [ ] On-the-fly generation with 1-month cache
- [ ] Native lazy loading (loading="lazy" attribute)
- [ ] GD driver for maximum compatibility

**Evidence:**
- ImageService.php implements on-the-fly optimization
- ProductImage component uses <picture> with WebP/JPEG sources
- Cache keys use MD5 for automatic invalidation

**Browser testing required:**
- [ ] WebP images load correctly in Chrome, Firefox, Safari
- [ ] Lazy loading activates on scroll (verify in Network tab)
- [ ] JPEG fallback works in older browsers

### 04-03: Performance & Deployment
**Status:** ‚úÖ Complete

**Deliverables verified:**
- [ ] Database indexes on products (is_active, created_at), price, orders (status, created_at)
- [ ] Product catalog cached with 6-hour TTL
- [ ] Site settings cached with 24-hour TTL
- [ ] Tag-based cache invalidation on admin updates
- [ ] Database error handling (ERR-02) with friendly 503 page
- [ ] DEPLOYMENT.md checklist created

**Evidence:**
- Migration adds composite index (is_active, created_at)
- ProductController implements Cache::tags('catalog')->remember()
- Setting::get() uses Cache::remember with 24h TTL
- bootstrap/app.php renders database-unavailable.blade.php on PDOException
- Admin controllers flush catalog cache on create/update/destroy

### 04.1 (this plan): Settings Integration
**Status:** üöß In progress

**Deliverables:**
- [ ] Storefront layout calls Setting::get() for phone, address, email, footer_text
- [ ] Admin changes to settings appear on storefront (after cache clear)
- [ ] Phase 4 verification document exists

## Requirements Coverage

### SEO Requirements
- [x] **SEO-01:** Product pages have unique meta tags (auto-generated or admin-customized)
- [x] **SEO-02:** Category pages have unique meta tags
- [x] **SEO-03:** SEO-friendly URLs (slug-based routing from Phase 1)
- [x] **SEO-04:** sitemap.xml generated daily
- [x] **SEO-05:** robots.txt dynamic (blocks non-production indexing)
- [x] **SEO-06:** Admin can edit meta tags for products (SEO tab in product form)
- [x] **SEO-07:** Admin can edit meta tags for categories (SEO section in category form)

### Performance Requirements
- [x] **PERF-01:** Lazy loading implemented (native loading="lazy" attribute)
- [x] **PERF-02:** Pagination at 20 items (from Phase 1)
- [x] **PERF-03:** Caching: catalog (6h), settings (24h), images (1 month)
- [x] **PERF-04:** Image optimization (WebP with JPEG fallback, 3 sizes)

### Error Handling
- [x] **ERR-02:** Database error handling (503 page when MySQL down)

### Security (production deployment)
- [ ] **SEC-06:** HTTPS for production environment (deployment step, not yet done)

## Known Gaps (Closed in Phase 4.1)

### 1. Settings Display Integration (FIXED)
**Gap:** Settings cached but not displayed on storefront
**Status:** ‚úÖ Closed in Task 1
**Evidence:** app.blade.php now calls Setting::get() for phone, address, email, footer_text

### 2. Phase 4 Verification Artifact (FIXED)
**Gap:** No verification document for Phase 4
**Status:** ‚úÖ Closed in Task 2
**Evidence:** This document

## Manual Testing Checklist

### SEO Testing
- [ ] Visit product page, view source: meta tags with title, description, og:image present
- [ ] Visit category page, view source: meta tags present
- [ ] Share product link in Facebook debugger: preview shows correct image/text
- [ ] Visit /sitemap.xml: XML file with all active products/categories
- [ ] Visit /robots.txt in dev: "Disallow: /" (blocks all)
- [ ] Visit /robots.txt in production: Allows indexing except /admin, /api, /cart

### Performance Testing
- [ ] Run `EXPLAIN` on catalog query: composite index used
- [ ] Check catalog response time: <100ms with 1000+ products
- [ ] Stop MySQL, visit site: see friendly error page (not stack trace)
- [ ] Admin: update product ‚Üí visit catalog: cache flushed (shows new data)
- [ ] PageSpeed Insights score: >80 on mobile and desktop

### Image Optimization Testing
- [ ] Inspect product image in DevTools: <picture> element with WebP source
- [ ] Network tab: WebP images loaded by Chrome/Firefox
- [ ] Network tab: lazy loading delays below-fold images
- [ ] Older browser (IE11 if available): JPEG fallback loads

### Settings Integration Testing
- [ ] Admin: change phone in Settings ‚Üí visit storefront ‚Üí see new phone in top bar
- [ ] Admin: change address in Settings ‚Üí visit storefront ‚Üí see new address in footer
- [ ] Admin: change email in Settings ‚Üí visit storefront ‚Üí see new email in footer
- [ ] Admin: change footer_text ‚Üí visit storefront ‚Üí see new text in footer description
- [ ] Run `php artisan cache:clear` ‚Üí verify settings update immediately

## Deployment Readiness

**Pre-deployment checklist (from DEPLOYMENT.md):**
- [ ] .env.production configured (APP_ENV=production, APP_DEBUG=false)
- [ ] Database migrated and seeded
- [ ] Storage linked (php artisan storage:link)
- [ ] Laravel optimized (php artisan optimize)
- [ ] SSL certificate installed (Let's Encrypt)
- [ ] Web server configured (nginx/Apache)
- [ ] Redis installed and configured (optional, file cache works)
- [ ] Cron configured for Laravel scheduler
- [ ] Sitemap generated (php artisan sitemap:generate)
- [ ] Error pages tested (stop MySQL, verify 503 page)

**Post-deployment verification:**
- [ ] Site loads over HTTPS
- [ ] Catalog page loads in <2 seconds
- [ ] Add to cart works
- [ ] Checkout creates order
- [ ] Admin login works
- [ ] Settings changes appear on storefront

## Remaining Minor Issues (Non-blocking)

From STATE.md blockers/concerns:
- **Admin sidebar mobile:** Doesn't collapse on mobile screens (hamburger menu needed) - Deferred to future enhancement
- **No admin dashboard:** Direct to orders index, no statistics page - Deferred to v2
- **Image optimization not tested in browser:** Needs manual verification in multiple browsers

## Phase 4 Sign-off

**Phase 4 goals achieved:**
- ‚úÖ SEO optimization complete (meta tags, sitemap, robots.txt, admin editor)
- ‚úÖ Image optimization complete (WebP, lazy loading, thumbnails, caching)
- ‚úÖ Performance optimization complete (indexes, caching, error handling)
- ‚úÖ Settings integration complete (admin ‚Üí storefront flow working)
- ‚úÖ Deployment documentation complete (DEPLOYMENT.md)

**Ready for production:** Yes (after SEC-06 HTTPS configuration during deployment)

---
*Verified: [DATE]*
*Phase 4 complete*
```

**Fill in:**
- [DATE] with current date
- Mark 04.1 deliverables as complete after Task 1 finishes
- All checkboxes based on evidence from summaries

**Why this structure:**
- Comprehensive coverage of all Phase 4 plans and requirements
- Evidence-based verification (references actual files and implementation)
- Manual testing checklist for browser verification
- Known gaps documented (and closed in this phase)
- Deployment readiness assessment
- Clear sign-off for phase completion
  </action>
  <verify>
1. Verify file exists: `ls .planning/phases/04-polish-launch/04-VERIFICATION.md`
2. Check file length: `wc -l .planning/phases/04-polish-launch/04-VERIFICATION.md` (should be 100+ lines)
3. Verify structure: file contains sections for all plans (04-01, 04-02, 04-03, 04.1)
4. Check requirements coverage: all SEO-01 through SEO-07, PERF-01 through PERF-04 listed
  </verify>
  <done>
- 04-VERIFICATION.md exists in phases/04-polish-launch/ directory
- Document covers all Phase 4 plans (04-01, 04-02, 04-03, 04.1)
- All requirements (SEO-01 to SEO-07, PERF-01 to PERF-04, ERR-02) documented
- Manual testing checklist included for browser verification
- Deployment readiness section present
  </done>
</task>

<task type="auto">
  <name>Task 3: Update ROADMAP.md to reflect Phase 4.1 completion</name>
  <files>.planning/ROADMAP.md</files>
  <action>
Update Phase 4.1 status in ROADMAP.md:

1. Find Phase 4.1 section (line ~98)
2. Update plan checkbox:
   - From: `- [ ] 04.1-01-PLAN.md ‚Äî Settings display integration and Phase 4 verification`
   - To: `- [x] 04.1-01-PLAN.md ‚Äî Settings display integration and Phase 4 verification`

3. Update Progress table (line ~140):
   - Phase 4.1 row: Change status from "Not started" to "‚úì Complete"
   - Update "Plans Complete" from "0/1" to "1/1"
   - Add "Completed" date (current date)

4. Verify no other Phase 4.1 references need updating

**Why these changes:**
- Marks Phase 4.1 as complete in roadmap
- Progress table accurately reflects 1/1 plans complete
- Maintains consistency with other phase completion entries
  </action>
  <verify>
1. Check Phase 4.1 plan checkbox is marked: `grep "04.1-01-PLAN.md" .planning/ROADMAP.md`
2. Verify Progress table shows Phase 4.1 complete: `grep "4.1.*Complete" .planning/ROADMAP.md`
3. Confirm completion date added to Progress table
  </verify>
  <done>
- ROADMAP.md Phase 4.1 plan checkbox marked complete [x]
- Progress table shows Phase 4.1 status as "‚úì Complete"
- Progress table shows "1/1" plans complete for Phase 4.1
- Completion date added to Progress table
  </done>
</task>

</tasks>

<verification>
**Overall phase checks:**

1. **Settings integration working:**
   - Visit storefront homepage
   - Inspect top bar: phone and address should NOT be hardcoded
   - Inspect footer: email and footer_text should NOT be hardcoded
   - Admin: go to Settings panel, change phone number, cache:clear, visit homepage: new phone appears

2. **Phase 4 verification exists:**
   - File `.planning/phases/04-polish-launch/04-VERIFICATION.md` exists
   - Contains verification for plans 04-01, 04-02, 04-03, 04.1
   - All SEO and PERF requirements documented

3. **ROADMAP updated:**
   - Phase 4.1 marked complete
   - Progress table shows 1/1 plans complete

4. **No regressions:**
   - Storefront layout still renders correctly (no broken HTML)
   - Cart functionality unchanged
   - Admin panel still accessible
</verification>

<success_criteria>
**Measurable completion:**

1. ‚úÖ Storefront top bar displays `Setting::get('site.phone')` instead of hardcoded phone
2. ‚úÖ Storefront top bar displays `Setting::get('site.address')` instead of hardcoded address
3. ‚úÖ Footer displays `Setting::get('site.email')` instead of hardcoded email
4. ‚úÖ Footer displays `Setting::get('site.footer_text')` instead of hardcoded description
5. ‚úÖ All Setting::get() calls have fallback values for graceful degradation
6. ‚úÖ Phase 4 verification document exists (100+ lines)
7. ‚úÖ ROADMAP.md reflects Phase 4.1 completion (checkbox marked, status updated)
8. ‚úÖ Admin Settings ‚Üí Storefront display flow verified (integration complete)

**Integration test:**
```bash
# Admin changes setting
php artisan tinker
>>> Setting::set('site.phone', '+996 (700) 12-34-56')
>>> exit

# Clear cache
php artisan cache:clear

# Visit homepage in browser
# Top bar should show: +996 (700) 12-34-56
```

**Phase 4.1 complete when:**
- Settings flow working end-to-end (admin changes appear on storefront)
- Phase 4 verification artifact documents all deliverables
- ROADMAP shows Phase 4.1 as complete
- Ready to proceed to Phase 4.2 (browser testing and production deployment)
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-settings-integration-verification/04.1-01-SUMMARY.md` documenting:
- Settings integration implementation
- Phase 4 verification document creation
- ROADMAP update
- Integration testing results
- Any issues encountered
</output>
