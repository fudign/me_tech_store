---
phase: 03-admin-panel
plan: 03
type: execute
wave: 2
depends_on: [03-01, 03-02]
files_modified:
  - resources/views/errors/404.blade.php
  - resources/views/errors/500.blade.php
  - resources/views/admin/layouts/app.blade.php
  - app/Exceptions/Handler.php
autonomous: true

must_haves:
  truths:
    - "User sees custom 404 page when visiting non-existent product or page"
    - "User sees custom 500 page when server error occurs"
    - "Admin sidebar shows all navigation items for Products, Categories, Orders, Settings"
    - "Current page highlighted in admin sidebar navigation"
    - "User sees success/error toast notifications after admin actions"
  artifacts:
    - path: "resources/views/errors/404.blade.php"
      provides: "Custom 404 error page"
      min_lines: 30
    - path: "resources/views/errors/500.blade.php"
      provides: "Custom 500 error page"
      min_lines: 30
    - path: "resources/views/admin/layouts/app.blade.php"
      provides: "Complete admin navigation menu"
      contains: "Каталог"
  key_links:
    - from: "resources/views/admin/layouts/app.blade.php"
      to: "route('admin.products.index')"
      via: "navigation menu"
      pattern: "admin\\.products\\.index"
    - from: "resources/views/errors/404.blade.php"
      to: "route('home')"
      via: "back to home link"
      pattern: "route\\('home'\\)"
---

<objective>
Complete admin panel with error handling pages and unified navigation, wire all admin sections together.

Purpose: Provide professional error pages for better UX and complete admin navigation structure connecting Products, Categories, Orders, and Settings.

Output: Custom 404/500 error pages and updated admin sidebar with full navigation menu.
</objective>

<execution_context>
@C:\Users\user\Desktop\mi_tech\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\user\Desktop\mi_tech\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\user\Desktop\mi_tech\.planning\PROJECT.md
@C:\Users\user\Desktop\mi_tech\.planning\phases\03-admin-panel\03-CONTEXT.md
@C:\Users\user\Desktop\mi_tech\.planning\phases\03-admin-panel\03-RESEARCH.md

## Existing Admin Layout
@C:\Users\user\Desktop\mi_tech\resources\views\admin\layouts\app.blade.php

## Dependencies
Plans 03-01 and 03-02 must complete first to know all admin routes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Custom Error Pages</name>
  <files>
    resources/views/errors/404.blade.php
    resources/views/errors/500.blade.php
  </files>
  <action>
Create custom error pages following RESEARCH pattern:

**404.blade.php:**
Extend main storefront layout (not admin layout, users see this):
```blade
@extends('layouts.app')
@section('title', 'Страница не найдена')
@section('content')
```

Structure:
- Large 404 icon (Iconify ghost icon, 120px width)
- Heading "404" (text-6xl)
- Subheading "Страница не найдена"
- Explanation text: "К сожалению, запрашиваемая страница не существует или была удалена."
- Two buttons:
  - "На главную" (blue, route('home'))
  - "Назад" (gray border, {{ url()->previous() }})
- Center aligned, max-w-2xl container

**500.blade.php:**
Similar structure to 404 but:
- Heading "500"
- Subheading "Ошибка сервера"
- Explanation: "Произошла внутренняя ошибка сервера. Мы уже работаем над исправлением."
- Single "На главную" button (no "Назад" - error might repeat)
- Same styling

Use Tailwind classes: bg-gray-50, rounded-lg, shadow, py-16, etc.
Icons from Iconify CDN (already loaded in layouts).
Mobile responsive with proper padding and text sizes.

Laravel automatically uses these views when 404/500 errors occur per RESEARCH docs.
</action>
  <verify>
```bash
ls resources/views/errors/
grep -n "404" resources/views/errors/404.blade.php
grep -n "500" resources/views/errors/500.blade.php
grep -n "route('home')" resources/views/errors/404.blade.php
```
  </verify>
  <done>
404.blade.php exists with custom design
500.blade.php exists with custom design
Both extend main layout
Navigation buttons included
Error pages automatically rendered by Laravel on errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Admin Sidebar Navigation</name>
  <files>resources/views/admin/layouts/app.blade.php</files>
  <action>
Update admin sidebar navigation to include all admin sections per CONTEXT structure:

**Current state:** Sidebar exists from Phase 2 with Orders link only

**Add navigation structure:**

Sidebar menu items (in order):
1. **Каталог** (expandable submenu with Iconify icon="solar:shopping-bag-linear")
   - Товары (Products) → route('admin.products.index')
   - Категории (Categories) → route('admin.categories.index')

2. **Заказы** (Orders) → route('admin.orders.index')
   - Icon: solar:document-linear
   - Badge showing new orders count (already exists from Phase 2)

3. **Настройки** (Settings) → route('admin.settings.index')
   - Icon: solar:settings-linear

**Submenu implementation with Alpine.js:**
```blade
<div x-data="{ catalogOpen: {{ request()->is('admin/products*') || request()->is('admin/categories*') ? 'true' : 'false' }} }">
  <button @click="catalogOpen = !catalogOpen" class="flex items-center justify-between w-full">
    <span>Каталог</span>
    <iconify-icon :icon="catalogOpen ? 'solar:alt-arrow-down-linear' : 'solar:alt-arrow-right-linear'"></iconify-icon>
  </button>

  <div x-show="catalogOpen" x-collapse>
    <!-- Submenu items -->
  </div>
</div>
```

**Active state highlighting:**
Use request()->routeIs() to highlight current page:
```blade
<a href="{{ route('admin.products.index') }}"
   class="{{ request()->routeIs('admin.products.*') ? 'bg-blue-100 text-blue-700' : 'text-gray-700 hover:bg-gray-100' }}">
  Товары
</a>
```

**Styling:**
- Main menu items: py-3 px-4, flex items-center gap-3
- Submenu items: pl-12 (indented), py-2
- Active: bg-blue-100 text-blue-700 border-r-4 border-blue-700
- Inactive: text-gray-700 hover:bg-gray-100
- Icons: 20px size, inherit color

Catalog submenu auto-expands when on products or categories pages.
Keep existing Phase 2 logout button at bottom of sidebar.
Maintain mobile responsive behavior (sidebar collapses on small screens).

Follow CONTEXT requirement: OpenCart-style sidebar with sections.
</action>
  <verify>
```bash
grep -n "Каталог" resources/views/admin/layouts/app.blade.php
grep -n "admin.products.index" resources/views/admin/layouts/app.blade.php
grep -n "admin.categories.index" resources/views/admin/layouts/app.blade.php
grep -n "admin.settings.index" resources/views/admin/layouts/app.blade.php
grep -n "catalogOpen" resources/views/admin/layouts/app.blade.php
```
  </verify>
  <done>
Admin sidebar has complete navigation structure
Catalog submenu with Products and Categories
Orders link maintained from Phase 2
Settings link added
Active state highlighting works
Submenu expands/collapses with Alpine.js
All routes reference Plan 01 and 02 deliverables
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire Success/Error Notifications</name>
  <files>resources/views/admin/layouts/app.blade.php</files>
  <action>
Add global success/error notification banners to admin layout per CONTEXT (not toasts):

**Location:** Top of @yield('content') section in admin layout

**Implementation:**
```blade
<!-- Success Banner -->
@if(session('success'))
<div x-data="{ show: true }"
     x-show="show"
     x-init="setTimeout(() => show = false, 5000)"
     class="mb-6 p-4 bg-green-100 border border-green-400 text-green-800 rounded-lg flex items-center justify-between">
  <div class="flex items-center gap-3">
    <iconify-icon icon="solar:check-circle-linear" class="text-2xl"></iconify-icon>
    <span>{{ session('success') }}</span>
  </div>
  <button @click="show = false" class="text-green-600 hover:text-green-800">
    <iconify-icon icon="solar:close-circle-linear"></iconify-icon>
  </button>
</div>
@endif

<!-- Error Banner -->
@if(session('error'))
<div x-data="{ show: true }"
     x-show="show"
     x-init="setTimeout(() => show = false, 5000)"
     class="mb-6 p-4 bg-red-100 border border-red-400 text-red-800 rounded-lg flex items-center justify-between">
  <div class="flex items-center gap-3">
    <iconify-icon icon="solar:close-circle-linear" class="text-2xl"></iconify-icon>
    <span>{{ session('error') }}</span>
  </div>
  <button @click="show = false" class="text-red-600 hover:text-red-800">
    <iconify-icon icon="solar:close-circle-linear"></iconify-icon>
  </button>
</div>
@endif
```

**Behavior:**
- Auto-dismiss after 5 seconds (Alpine.js setTimeout)
- Manual dismiss with X button
- Green for success, red for error
- Icon + message + close button layout
- Full width banner above page content

**Controllers already use flash messages:**
Plans 01 and 02 controllers use ->with('success', '...) and ->with('error', '...')
This task just displays them globally in admin layout.

Follows CONTEXT requirement: "Баннер вверху страницы" not toast notifications.
</action>
  <verify>
```bash
grep -n "session('success')" resources/views/admin/layouts/app.blade.php
grep -n "session('error')" resources/views/admin/layouts/app.blade.php
grep -n "setTimeout.*show = false" resources/views/admin/layouts/app.blade.php
```
  </verify>
  <done>
Success banner displays at top of admin content area
Error banner displays at top of admin content area
Auto-dismiss after 5 seconds
Manual dismiss button works
Uses Alpine.js for state management
Green for success, red for error
Follows CONTEXT banner design (not toast)
  </done>
</task>

</tasks>

<verification>
**Test error pages:**
1. Visit non-existent URL: http://localhost:8000/nonexistent - see custom 404
2. Simulate 500 error by temporarily breaking a controller - see custom 500
3. Click "На главную" and "Назад" buttons - navigation works

**Test admin navigation:**
1. Visit /admin/products - sidebar shows, Products highlighted, Catalog expanded
2. Visit /admin/categories - Categories highlighted, Catalog still expanded
3. Visit /admin/orders - Orders highlighted, Catalog collapsed
4. Visit /admin/settings - Settings highlighted
5. On mobile: sidebar collapses properly

**Test notifications:**
1. Create product - success banner appears at top, auto-dismisses after 5s
2. Try to delete category with products - error banner appears
3. Click X button on banner - dismisses immediately
4. Create category - success banner with green styling

**Full admin panel flow:**
1. Login to admin
2. See sidebar with Каталог (Товары, Категории), Заказы, Настройки
3. Navigate between all sections - active states work
4. Perform CRUD operations - flash messages appear correctly
5. Visit invalid admin route - 404 error page (but custom one)
</verification>

<success_criteria>
- Custom 404 page displays for non-existent routes with proper design
- Custom 500 page displays for server errors
- Admin sidebar has complete navigation: Catalog submenu (Products, Categories), Orders, Settings
- Active page highlighted in sidebar navigation
- Catalog submenu auto-expands when on products/categories pages
- Success flash messages display as green banners at top
- Error flash messages display as red banners at top
- Notifications auto-dismiss after 5 seconds
- Manual dismiss button works on notifications
- All admin sections accessible from sidebar
- Navigation follows OpenCart-style structure per CONTEXT
</success_criteria>

<output>
After completion, create `.planning/phases/03-admin-panel/03-03-SUMMARY.md` using summary template.

Document:
- Error page implementation approach
- Admin navigation structure (menu hierarchy)
- Notification banner implementation (Alpine.js pattern)
- Any styling decisions made
- Any deviations from plan

Mark Phase 3 as COMPLETE in roadmap and STATE.md.
</output>
